import { TextEdit, ScrollView, ComboBox, LineEdit, Palette, Button } from "std-widgets.slint";
import { EditorSpaceSettings } from "styling.slint";
import { Api } from "../api.slint";

export enum GradientKind {
    linear,
    radial
}
export struct GradientColor {
    value: color,
    location: percent}
export struct GradientData {
    gradient-kind: GradientKind,
    gradient-angle: length,
    gradient-colors: [GradientColor]
}
export component GradientDot inherits Rectangle {
    in property <percent> position;
    in property <color> value;
    in-out property <bool> selected: false;
    function enable() {
        root.selected = true;
    }
    function disable() {
        root.selected = false;
    }
    callback new-selection();
    width: self.selected ? 20px : 10px;
    height: self.selected ? 20px : 10px;
    border-radius: self.width;
    background: value;
    border-width: 1px;
    border-color: gray;
    TouchArea {
        clicked => {
            if !root.selected {;
                new-selection();
            }
        }
    }
}

component EditGradientWidget inherits VerticalLayout {
    in property <bool> enabled;
    in property <string> property-name;
    in property <GradientData> property-value;
    height: self.preferred-height;
    padding: EditorSpaceSettings.default-padding;
    spacing: EditorSpaceSettings.default-spacing;

    grad:=Rectangle {
        height: 40px;
        background: @linear-gradient(90deg, #fff 0%, #000 100%);
        Rectangle {
            height: 1px;
            background: grey;
            for i[index] in [{ pos:0, value:#fff }, { pos:35, value:#f00 }, { pos:100, value:#000 }]: GradientDot {
                selected:false;
                new-selection => {
                    self.selected = true;
                }
                x: i.pos * (grad.width - self.width) / 100;
                value: i.value;
            }
        }
    }

    HorizontalLayout {
        alignment: stretch;
        spacing: 8px;
        vertical-stretch: 0;
        HorizontalLayout {
            Text {
                vertical-alignment: center;
                text: "Type:";
            }

            ComboBox {
                horizontal-stretch: 0;
                width: 80%;
                model: ["linear", "radial"];
            }
        }

        HorizontalLayout {
            alignment: end;
            spacing: 4px;
            Text {
                vertical-alignment: center;
                text: "Angle:";
            }
            le:=LineEdit {
                width: 3rem;
                input-type: number;
            }

            ComboBox {
                width: 80%;
                model: [
                    "Deg",
                    "rad",
                ];
            }

            VerticalLayout {
                Image {
                    source: @image-url("../assets/dial.svg");
                    colorize: Palette.alternate-foreground.transparentize(0.7);
                    width: 30px;
                    rotation-angle: -30deg;
                }
            }
        }
    }

    HorizontalLayout {
        alignment: space-between;
        spacing: 4px;
        HorizontalLayout {
            spacing: 4px;
            LineEdit {
                width: 9rem;
                text: "#ffffffff";
            }
            Rectangle {
                background: #fff;
                width: 40px;
                height: 25px;
            }
        }
        HorizontalLayout {
            spacing: 4px;
            Text {
                vertical-alignment: center;
                text: "Position:";
            }
            LineEdit {
                text: "0";
                width: 5rem;
            }
        }
    }
    HorizontalLayout {
        padding-top: 8px;
        spacing: EditorSpaceSettings.default-spacing;
        Button {text: "Reset";}
        Button {text: "Code";}
    }

}
export component Example inherits Window {
    width: 360px;
    EditGradientWidget {}
}